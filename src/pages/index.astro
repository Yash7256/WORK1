---
import SiteHead from '../components/SiteHead.astro'
import SiteFoot from '../components/SiteFoot.astro'
import SiteScrollbar from '../components/SiteScrollbar.astro'
import SHero from '../components/SHero.astro'
import SAbout from '../components/SAbout.astro'
import SWork from '../components/SWork.astro'
import SMyWay from '../components/SMyWay.astro'
import SCTA from '../components/SCTA.astro'
import ASeparator from '../components/ASeparator.astro'

import '../styles/global.scss'
---

<html lang="en" class="is-scroll-blocked theme-contrasted">
  <head>
    <meta charset="utf-8" />

    <title>PARI</title>

    <meta
      name="description"
      content="Take a peek behind the scenes of a senior dev’s awarded portfolio. Clone it, learn from it, build your own. But don’t just steal it—the community will call you out, and you’ll doom yourself to eternal mediocrity." />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />

    <meta name="robots" content="noindex, nofollow" />
    <link rel="canonical" href="https://public.wodniack.dev/" />

    <link
      rel="icon"
      type="image/png"
      href="/icons/favicon-48x48.png"
      sizes="48x48"
    />
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
    <link rel="shortcut icon" href="/icons/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/icons/apple-touch-icon.png"
    />
    <meta name="apple-mobile-web-app-title" content="AW Portfolio" />

    <meta name="theme-color" content="#160000" />
    <meta name="msapplication-navbutton-color" content="#160000" />
    <meta name="apple-mobile-web-app-status-bar-style" content="#160000" />

    <meta property="og:locale" content="en_GB" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Antoine Wodniack 2025 Portfolio – Open Source Edition" />
    <meta property="og:description" content="Take a peek behind the scenes of a senior dev’s awarded portfolio. Clone it, learn from it, build your own. But don’t just steal it—the community will call you out, and you’ll doom yourself to eternal mediocrity." />
    <meta property="og:url" content="https://public.wodniack.dev/" />
    <meta property="og:site_name" content="Antoine Wodniack 2025 Portfolio – Open Source Edition" />
    <meta property="og:image" content="https://public.wodniack.dev/images/aw-creative-developer.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="675" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="https://public.wodniack.dev/images/aw-creative-developer.png" />

    <link
      rel="preload"
      href="/fonts/PPEditorialNew-Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/PPEditorialNew-Ultralight.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/PPFraktionMono-Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/PPFraktionMono-Bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/Bigger-Display.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div class="site-wrapper js-site-wrapper" style="opacity: 0;">
      <SiteHead />

      <SHero />

      <SAbout />

      <ASeparator style="secondary" />

      <SWork />

      <ASeparator style="secondary" />

      <SMyWay />

      <SCTA />

      <SiteFoot />
    </div><!-- .site-wrapper -->

    <div
      class="site-intro js-intro"
      style="opacity: 1; position: fixed; top: 0; left: 0; z-index: 50; width: 100%; height: 100%; background: #F40C3F;"
    >
      <canvas class="site-intro__heart js-intro-heart" aria-hidden="true"></canvas>
      <div class="sb-logo js-logo">
        <div class="sb__path sb__path--v sb__path--v-1 js-logo-line-v"></div>
        <div class="sb__path sb__path--h sb__path--h-1 js-logo-line-h"></div>
        <div class="sb__path sb__path--v sb__path--v-2 js-logo-line-v"></div>
        <div class="sb__path sb__path--v sb__path--v-3 js-logo-line-v"></div>
        <div class="sb__path sb__path--h sb__path--h-2 js-logo-line-h"></div>
        <div class="sb__path sb__path--v sb__path--v-4 js-logo-line-v"></div>
        <div class="sb__path sb__path--h sb__path--h-3 js-logo-line-h"></div>
        <div class="sb__path sb__path--v sb__path--v-5 js-logo-line-v"></div>
      </div><!-- .sb-logo -->

      <div class="site-intro__border site-intro__border--top js-border-top">
      </div>
      <div class="site-intro__border site-intro__border--left js-border-left">
      </div>
      <div class="site-intro__border site-intro__border--right js-border-right">
      </div>
    </div><!-- .site-intro -->

    <div class="site-mount js-mount"></div>
    <div class="site-contrast-mask js-contrast-mask"></div>

    <SiteScrollbar />
  </body>

  <script>
    import Emitter from '../utils/Emitter'
    import Ticker from '../utils/Ticker'

    import Lenis from 'lenis'

    import { gsap } from 'gsap'
    import { ScrollTrigger } from 'gsap/ScrollTrigger'
    gsap.registerPlugin(ScrollTrigger)

    declare global {
      interface Window {
        safeWidth: number
        safeHeight: number
        maxScrollTop: number
        scrollProgress: number
        lenis: any
      }
    }

    class Site {
      timeouts: any = {
        resizeThrottle: null,
      }

      windowWidth: number
      windowHeight: number
      clientWidth: number
      clientHeight: number

      isScrolling: boolean = false

      lenis: any

      /**
       * Constructor
       */
      constructor() {
        // OS class
        let os = 'unknown'
        if (navigator.userAgent.indexOf('Win') !== -1) {
          os = 'windows'
        } else if (navigator.userAgent.indexOf('Android') !== -1) {
          os = 'android'
        } else if (navigator.userAgent.indexOf('Mac') !== -1) {
          os = 'mac'
        } else if (navigator.userAgent.indexOf('Linux') !== -1) {
          os = 'linux'
        }
        document.documentElement.classList.add(`is-${os}`)

        // Browser class
        let browser = 'unknown'
        if (navigator.userAgent.indexOf('Firefox') !== -1) {
          browser = 'firefox'
        } else if (navigator.userAgent.indexOf('Chrome') !== -1) {
          browser = 'chrome'
        } else if (navigator.userAgent.indexOf('Safari') !== -1) {
          browser = 'safari'
        }
        document.documentElement.classList.add(`is-${browser}`)

        this.bindEvents()
      }

      /**
       * Initialization
       */
      init() {
        this.initLenis()

        Ticker.init()

        this.onResize()
        Ticker.nextTick(this.intro, this)
      }

      /**
       * Bind events
       */
      bindEvents() {
        window.addEventListener('resize', this.resizeThrottle.bind(this))
        window.addEventListener('scroll', this.onScroll.bind(this), {
          passive: true,
        })
        window.addEventListener('mousemove', this.onMouseMove.bind(this), {
          passive: true,
        })

        Emitter.on('updateViewport', this.onResize, this, true)

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              entry.target.dispatchEvent(
                new CustomEvent('intersect', {
                  detail: { isIntersecting: entry.isIntersecting },
                })
              )

              if (entry.isIntersecting) {
                entry.target.classList.add('is-in-view')
                entry.target.classList.remove(
                  'is-out-of-view',
                  'is-out-of-view-top',
                  'is-out-of-view-bottom'
                )
              } else {
                entry.target.classList.remove('is-in-view')
                entry.target.classList.add('is-out-of-view')

                entry.target.classList.toggle(
                  'is-out-of-view-top',
                  entry.boundingClientRect.top < 0
                )
                entry.target.classList.toggle(
                  'is-out-of-view-bottom',
                  entry.boundingClientRect.top > 0
                )
              }
            })
          },
          {
            threshold: 0,
          }
        )

        document.querySelectorAll('[data-intersect]').forEach((el) => {
          observer.observe(el)
        })

        this.onScroll()
      }

      /**
       * Init lenis
       */
      initLenis() {
        const lenis = new Lenis()

        lenis.on('scroll', ScrollTrigger.update)

        gsap.ticker.add((time) => {
          lenis.raf(time * 1000)
        })

        gsap.ticker.lagSmoothing(0)

        window.lenis = lenis
        this.lenis = lenis
      }

      /**
       * Set loaded class
       */
      siteLoaded() {
        document.documentElement.classList.add('is-loaded')

        Emitter.emit('siteLoaded')
      }

      /**
       * Resize throttle
       */
      resizeThrottle() {
        clearTimeout(this.timeouts.resizeThrottle)

        this.timeouts.resizeThrottle = setTimeout(() => {
          Ticker.nextTick(this.onResize, this)
        }, 200)
      }

      /**
       * Resize handler
       */
      onResize() {
        const newWidth = window.innerWidth
        let widthChanged = false
        if (this.windowWidth !== newWidth) {
          if (this.windowWidth !== undefined) {
            widthChanged = true
          }

          this.windowWidth = newWidth
          this.clientWidth = document.body.clientWidth
        }

        const newHeight = window.innerHeight
        let heightChanged = false
        if (this.windowHeight !== newHeight) {
          if (this.windowHeight !== undefined) {
            heightChanged = true
          }

          this.windowHeight = newHeight
          this.clientHeight = document.body.clientHeight
        }

        window.safeWidth = newWidth
        window.safeHeight = newHeight

        window.maxScrollTop = document.body.scrollHeight - window.safeHeight

        this.setScrollProgress()

        Emitter.emit('resize', widthChanged, heightChanged)
      }

      /**
       * Scroll handler
       */
      onScroll() {
        this.setScrollProgress()

        Ticker.nextTick(() => {
          Emitter.emit('scroll', window.scrollY)
        })
      }

      /**
       * Set scroll progress
       */
      setScrollProgress() {
        window.scrollProgress = window.scrollY / window.maxScrollTop
      }

      /**
       * Mouse move handler
       */
      onMouseMove(e) {
        Emitter.emit('mousemove', e.clientX, e.clientY)
      }

      /**
       * Intro
       */
      intro() {
        // Selectors
        const wrapper: HTMLElement = document.querySelector('.js-site-wrapper')
        const intro: HTMLElement = document.querySelector('.js-intro')
        const mount: HTMLElement = document.querySelector('.js-mount')
        const heartCanvas: HTMLCanvasElement =
          intro.querySelector('.js-intro-heart')
        const logoLinesV: NodeList = intro.querySelectorAll('.js-logo-line-v')
        const logoLinesH: NodeList = intro.querySelectorAll('.js-logo-line-h')
        const borderTop: HTMLElement = intro.querySelector('.js-border-top')
        const borderLeft: HTMLElement = intro.querySelector('.js-border-left')
        const borderRight: HTMLElement = intro.querySelector('.js-border-right')

        const holdSeconds = 6
        const shouldShowValentine =
          !window.sessionStorage.getItem('skipHeartIntro')

        // Timeline
        const tl = gsap.timeline()

        if (shouldShowValentine) {
          const stopHeart = this.startIntroHeart(heartCanvas)

          tl.to(
            {},
            {
              duration: holdSeconds,
            },
            0
          )

          tl.call(
            () => {
              stopHeart()
              window.location.href = '/valentine'
            },
            null,
            holdSeconds
          )

          return
        }

        tl.set(intro, {
          background: 'transparent',
        })

        tl.fromTo(
          logoLinesV,
          {
            scaleY: 0,
          },
          {
            scaleY: 1,
            duration: 1,
            ease: 'power4.inOut',
            stagger: 0.15,
          },
          0
        )

        tl.fromTo(
          logoLinesH,
          {
            scaleX: 0,
          },
          {
            scaleX: 1,
            duration: 0.4,
            ease: 'power4.inOut',
            stagger: 0,
          },
          1
        )

        tl.set(logoLinesV, {
          transformOrigin: '50% 0',
        })

        tl.fromTo(
          logoLinesV,
          {
            scaleY: 1,
          },
          {
            scaleY: 0,
            duration: 1,
            ease: 'power4.in',
            immediateRender: false,
            stagger: 0.1,
          },
          2
        )

        tl.fromTo(
          logoLinesH,
          {
            scaleY: 1,
          },
          {
            scaleY: 0,
            duration: 0.5,
            ease: 'power4.in',
            immediateRender: false,
            stagger: 0.1,
          },
          2.1
        )

        tl.from(
          borderTop,
          {
            scaleY: 0,
            duration: 3,
            ease: 'power3.inOut',
          },
          1
        )

        tl.from(
          [borderLeft, borderRight],
          {
            scaleX: 0,
            duration: 3,
            ease: 'power3.inOut',
          },
          1
        )

        tl.call(
          () => {
            mount.style.opacity = '1'
            intro.remove()

            wrapper.style.opacity = ''

            document.documentElement.classList.remove('is-scroll-blocked')

            Ticker.nextTick(() => {
              Emitter.emit('updateViewport')
            })

            this.siteLoaded()
            document.dispatchEvent(new CustomEvent('intro'))
          },
          null,
          5
        )
      }

      /**
       * Heart intro animation
       */
      startIntroHeart(canvas: HTMLCanvasElement) {
        if (!canvas) return () => {}

        const ctx = canvas.getContext('2d')
        if (!ctx) return () => {}

        const isMobile = window.innerWidth <= 767
        const koef = isMobile ? 0.5 : 1

        const width = Math.max(1, Math.floor(window.innerWidth * koef))
        const height = Math.max(1, Math.floor(window.innerHeight * koef))

        canvas.width = width
        canvas.height = height

        const heartPosition = (rad) => {
          return [
            Math.pow(Math.sin(rad), 3),
            -(
              15 * Math.cos(rad) -
              5 * Math.cos(2 * rad) -
              2 * Math.cos(3 * rad) -
              Math.cos(4 * rad)
            ),
          ]
        }

        const scaleAndTranslate = (pos, sx, sy, dx, dy) => {
          return [dx + pos[0] * sx, dy + pos[1] * sy]
        }

        const traceCount = isMobile ? 20 : 50
        const pointsOrigin = []
        const dr = isMobile ? 0.3 : 0.1

        for (let i = 0; i < Math.PI * 2; i += dr) {
          pointsOrigin.push(scaleAndTranslate(heartPosition(i), 210, 13, 0, 0))
        }
        for (let i = 0; i < Math.PI * 2; i += dr) {
          pointsOrigin.push(scaleAndTranslate(heartPosition(i), 150, 9, 0, 0))
        }
        for (let i = 0; i < Math.PI * 2; i += dr) {
          pointsOrigin.push(scaleAndTranslate(heartPosition(i), 90, 5, 0, 0))
        }

        const pointsCount = pointsOrigin.length
        const targetPoints = []
        const particles = []

        for (let i = 0; i < pointsCount; i++) {
          const x = Math.random() * width
          const y = Math.random() * height
          const trace = []
          for (let k = 0; k < traceCount; k++) {
            trace[k] = { x, y }
          }

          particles.push({
            vx: 0,
            vy: 0,
            speed: Math.random() + 5,
            q: Math.floor(Math.random() * pointsCount),
            D: 2 * (i % 2) - 1,
            force: 0.2 * Math.random() + 0.7,
            f: `hsla(0, ${Math.floor(40 * Math.random() + 100)}%, ${Math.floor(
              60 * Math.random() + 20
            )}%, .3)`,
            trace,
          })
        }

        const config = {
          traceK: 0.4,
          timeDelta: 0.01,
        }

        let time = 0
        let running = true

        const pulse = (kx, ky) => {
          for (let i = 0; i < pointsOrigin.length; i++) {
            targetPoints[i] = []
            targetPoints[i][0] = kx * pointsOrigin[i][0] + width / 2
            targetPoints[i][1] = ky * pointsOrigin[i][1] + height / 2
          }
        }

        const loop = () => {
          if (!running) return

          const n = -Math.cos(time)
          pulse((1 + n) * 0.5, (1 + n) * 0.5)
          time +=
            (Math.sin(time) < 0 ? 9 : n > 0.8 ? 0.2 : 1) * config.timeDelta

          ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'
          ctx.fillRect(0, 0, width, height)

          for (let i = particles.length - 1; i >= 0; i--) {
            const u = particles[i]
            const q = targetPoints[u.q]
            const dx = u.trace[0].x - q[0]
            const dy = u.trace[0].y - q[1]
            const length = Math.sqrt(dx * dx + dy * dy) || 1

            if (length < 10) {
              if (0.95 < Math.random()) {
                u.q = Math.floor(Math.random() * pointsCount)
              } else {
                if (0.99 < Math.random()) {
                  u.D *= -1
                }
                u.q += u.D
                u.q %= pointsCount
                if (u.q < 0) {
                  u.q += pointsCount
                }
              }
            }

            u.vx += (-dx / length) * u.speed
            u.vy += (-dy / length) * u.speed
            u.trace[0].x += u.vx
            u.trace[0].y += u.vy
            u.vx *= u.force
            u.vy *= u.force

            for (let k = 0; k < u.trace.length - 1; ) {
              const T = u.trace[k]
              const N = u.trace[++k]
              N.x -= config.traceK * (N.x - T.x)
              N.y -= config.traceK * (N.y - T.y)
            }

            ctx.fillStyle = u.f
            for (let k = 0; k < u.trace.length; k++) {
              ctx.fillRect(u.trace[k].x, u.trace[k].y, 1, 1)
            }
          }

          window.requestAnimationFrame(loop)
        }

        ctx.fillStyle = 'rgba(0, 0, 0, 1)'
        ctx.fillRect(0, 0, width, height)

        window.requestAnimationFrame(loop)

        return () => {
          running = false
        }
      }
    }

    const site = new Site()

    // Site init on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', site.init, { once: true })
    } else {
      site.init()
    }
  </script>

  <style lang="scss">
    body {
      position: relative;

      padding: 1rem;
      min-height: 100vh;

      @include mq(phone) {
        padding: 0.5rem;
      }
    }

    .site-contrast-mask {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 20;

      width: 100%;
      height: 100%;

      background: map.get($theme-colors, 'default', 'primary');
      border-color: map.get($theme-colors, 'default', 'secondary');
      border-style: solid;
      border-width: 0 1rem 0 0;
      mix-blend-mode: darken;
      transform: translate3d(-100%, 0, 0);

      pointer-events: none;
      will-change: transform;

      @include mq(phone) {
        border-right-width: 0.5rem;
      }
    }

    .site-intro {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 50;

      width: 100%;
      height: 100%;

      background: color(primary);

      &__heart {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;

        width: 100%;
        height: 100%;

        pointer-events: none;
      }

      .sb-logo {
        position: absolute;
        top: 50%;
        left: 50%;

        width: 3rem;
        height: 3rem;

        transform: translate3d(-50%, -50%, 0);

        @include mq(phone) {
          width: 1.875rem;
          height: 1.875rem;
        }

        .sb__path {
          position: absolute;

          background: color(secondary);

          &--v {
            top: 0;

            width: 14.2857%;
            height: 100%;

            transform-origin: 50% 100%;

            &-1 {
              left: 0;
            }

            &-2 {
              left: 21.3214%;
            }

            &-3 {
              left: 43.2143%;
            }

            &-4 {
              left: 64.7857%;
            }

            &-5 {
              right: 0;
            }
          }

          &--h {
            width: 7.5%;
            height: 6%;

            &-1 {
              top: 0;
              left: 14.2857%;

              transform-origin: 100% 0;
            }

            &-2 {
              left: 57.5%;
              bottom: 0;

              transform-origin: 0 0;
            }

            &-3 {
              right: 14.2857%;
              bottom: 0;

              transform-origin: 0% 0;
            }
          }
        }
      }

      &__border {
        --width: 1rem;

        position: absolute;

        background: color(secondary);

        @include mq(phone) {
          --width: 0.5rem;
        }

        &--top {
          top: 0;
          left: 0;

          width: 100%;
          height: var(--width);

          transform-origin: 50% 0;
        }

        &--left,
        &--right {
          top: 0;
          left: 0;

          width: var(--width);
          height: 100%;
        }

        &--left {
          transform-origin: 0 50%;
        }

        &--right {
          left: auto;
          right: 0;

          transform-origin: 100% 50%;
        }
      }
    }

    .site-wrapper {
      position: relative;
      z-index: 2;

      background: color(primary);
      clip-path: inset(0 -1rem);

      @include mq(phone) {
        clip-path: inset(0 -0.5rem);
      }
    }

    .site-mount {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;

      width: 100%;
      height: 100%;

      border: 1rem solid color(secondary);

      opacity: 0;
      will-change: border-width;

      pointer-events: none;
    }
  </style>
</html>
